import { FullPageLoader } from "components/full-page-loader";
import { hsl, range } from "d3";
import { flatten, sample, sortBy } from "lodash";
import { AnimatePresence, motion } from "framer-motion";
import type { GetServerSidePropsContext } from "next";
import getConfig from "next/config";
import { useRouter } from "next/router";
import { signOut, useSession } from "next-auth/react";
import Link from "next/link";
import { useEffect, useMemo, useState } from "react";
import { ChevronRightIcon } from "@primer/octicons-react";
import { getOwnerRepoFromDevServer } from "ghapi";

const { publicRuntimeConfig } = getConfig();

function Home() {
  const { devServer } = useRouter().query as Record<string, string>;
  const { status, data } = useSession({ required: true });

  useEffect(() => {
    if (status === "authenticated" && data.error) {
      signOut();
    }
  }, [data, status]);

  if (status === "loading") {
    return <FullPageLoader />;
  }
  const imagePositions = [
    [-48, -13],
    [-45, 4],
    [-38, 13.6],
    [36, 15],
    [46, 6],
    [51, -8],
    [20, 30],
  ];

  return (
    <div className="pb-60">
      <div className="relative h-[96vh] overflow-hidden flex items-center justify-center">
        <div className="absolute inset-0 opacity-60">
          {range(0, 6).map((i) => (
            <motion.img
              key={i}
              src={`/block-demo-${i + 1}.png`}
              className="absolute top-[25vw] left-[40vw] w-80 shadow-lg rounded-3xl border"
              animate={{
                x: imagePositions[i][0] + "vw",
                y: imagePositions[i][1] + "vw",
              }}
            />
          ))}
        </div>
        <div className="w-full px-4 lg:px-0 flex flex-col items-center justify-center z-10 pb-6">
          <h1 className="text-[9vw] font-bold tracking-tight text-gray-800 leading-[0.8em]">
            GitHub{" "}
            <span
              className="inline-block font-black pr-1 -mr-1"
              style={{
                background: "linear-gradient(90deg, #db469f 0%, #2188ff 120%)",
                WebkitBackgroundClip: "text",
                WebkitTextFillColor: "transparent",
                WebkitBoxDecorationBreak: "clone",
                backgroundClip: "text",
              }}
            >
              Blocks
            </span>
          </h1>
          <p className="mt-12 text-2xl tracking-[0.016em] text-gray-600 font-light text-center">
            We know your code is more than just text, now we're making it easy
            to show it.
            <br />
            Bring your repositories to life with Blocks.
          </p>
          <div className="mt-2 text-2xl flex items-center bg-white px-10">
            <div className="font-light text-xl">an exploration by</div>
            <img
              className="w-[1.5em] ml-2"
              src="/next-octocat.svg"
              alt="GitHub Next logo"
            />
            <div className="font-bold tracking-tight">
              GitHub
              <span className="font-normal ml-1">Next</span>
            </div>
          </div>
          <div className="mt-12 space-x-4 pointer-events-auto">
            <Link
              href={{
                pathname: "/githubnext/blocks-tutorial",
                query: {
                  path: "README.md",
                  ...(devServer ? { devServer } : {}),
                },
              }}
            >
              <a className="inline-flex items-center px-8 py-4 text-lg border border-transparent leading-4 font-medium rounded-md shadow-sm text-white bg-gradient-to-b from-gray-700 to-gray-900 hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                Let's get started
                <span className="inline-block ml-1">
                  <ChevronRightIcon size={20} />
                </span>
              </a>
            </Link>
          </div>
        </div>
      </div>
      <Features />
    </div>
  );
}

export default Home;

const Features = () => {
  const [imageIndex, setImageIndex] = useState(0);

  return (
    <div className="my-20 -mt-20">
      <div className="absolute -mt-60 w-full h-screen">
        <GradientBackground />
      </div>
      <div className="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* <h2 className="text-3xl mb-10 font-extrabold text-gray-900 tracking-tight">
          How do you want to view your content?
        </h2> */}
        <div
          className="relative p-[6%] text-gray-200 bg-white whitespace-pre w-full border border-white rounded-2xl shadow-xl flex items-center justify-center overflow-hidden"
          style={{
            fontFamily: "Fira Code",
          }}
          onClick={() => {
            setImageIndex((imageIndex + 1) % 2);
          }}
        >
          <div className="absolute inset-3 text-xs">{dataText}</div>
          <div className=" z-10 w-[90%] h-[70%] overflow-hidden border rounded-xl shadow-lg">
            <img src={`/block-data-${imageIndex + 1}.png`} />
          </div>
        </div>
      </div>
    </div>
  );
};

const GradientBackground = () => {
  const colors = [
    "#db469f",
    "#2188ff",
    "#f6c343",
    "#f6c343",
    "#2188ff",
    "#db469f",
  ];

  return (
    <svg
      className="absolute inset-0 w-full h-full opacity-30"
      viewBox="0 0 10 10"
    >
      <defs>
        <filter id="blur" x="-100%" y="-100%" width="500%" height="500%">
          <feGaussianBlur in="SourceGraphic" stdDeviation="1" />
        </filter>
        <filter id="multiply" x="-50%" y="-50%" width="200%" height="200%">
          <feColorMatrix
            in="SourceGraphic"
            type="matrix"
            values="1 0 0 0 0
                    0 1 0 0 0
                    0 0 1 0 0
                    0 0 0 1 0"
          />
        </filter>
      </defs>
      {colors.map((color, i) => (
        <g filter="url(#blur)" key={i}>
          <circle
            key={i}
            cx={i * 2}
            cy={-Math.sin(i) + 5}
            r={2}
            fill={color}
            filter="url(#multiply)"
            className="mix-blend-multiply"
          />
        </g>
      ))}
    </svg>
  );
};
const dataText = `"time","summary","icon","sunriseTime","sunsetTime","moonPhase","precipIntensity","precipIntensityMax","precipIntensityMaxTime","precipProbability","precipType","temperatureHigh","temperatureHighTime","temperatureLow","temperatureLowTime","apparentTemperatureHigh","apparentTemperatureHighTime","apparentTemperatureLow","apparentTemperatureLowTime","dewPoint","humidity","pressure","windSpeed","windGust","windGustTime","windBearing","cloudCover","uvIndex","uvIndexTime","visibility","ozone","temperatureMin","temperatureMinTime","temperatureMax","temperatureMaxTime","apparentTemperatureMin","apparentTemperatureMinTime","apparentTemperatureMax","apparentTemperatureMaxTime","date"
1609401600,"Clear throughout the day.","rain",1609428360,1609462920,0.57,0.0015,0.0369,1609401600,0.55,"rain",57.38,1609455840,46.19,1609513200,56.88,1609455840,45.53,1609507140,43.62,0.72,1022.2,6.8,17.22,1609417680,313,0.16,2,1609445820,10,313.6,48.24,1609430100,57.38,1609455840,45.76,1609424220,56.88,1609455840,"2020-12-31"
1609488000,"Mostly cloudy throughout the day.","partly-cloudy-day",1609514760,1609549380,0.6,0.0004,0.0014,1609523520,0.11,"rain",54.5,1609542000,48.41,1609596060,54,1609542000,45.83,1609597500,42.94,0.76,1021.5,4.14,11.69,1609546440,203,0.54,2,1609531920,10,310.9,46.04,1609515420,54.5,1609542000,45.44,1609516440,54,1609542000,"2021-01-01"
1609574400,"Possible light rain in the morning.","rain",1609601220,1609635840,0.64,0.0031,0.0102,1609585620,0.49,"rain",51.57,1609633320,48.76,1609686000,51.07,1609633320,47.98,1609686000,46.82,0.88,1023.6,3.9,10.34,1609599360,113,0.98,2,1609618560,9.657,306.4,48.41,1609596060,51.57,1609633320,45.83,1609597500,51.07,1609633320,"2021-01-02"
1609660800,"Possible drizzle overnight.","rain",1609687620,1609722300,0.67,0.0015,0.0064,1609740060,0.42,"rain",51.8,1609714800,49.99,1609729200,51.3,1609714800,50.48,1609729200,47.5,0.9,1023.4,3.1,7.08,1609695540,144,0.96,2,1609704960,7.669,301.3,48.5,1609689240,51.8,1609714800,47.73,1609688280,51.3,1609714800,"2021-01-03"
1609747200,"Rain in the morning and afternoon.","rain",1609774020,1609808700,0.71,0.0168,0.1281,1609786800,0.93,"rain",57.44,1609790880,45.04,1609858800,56.94,1609790880,43.03,1609858800,48.61,0.82,1020.2,9.21,27.09,1609782360,192,0.77,2,1609791120,9.83,321.2,49.9,1609830000,57.44,1609790880,50.39,1609830000,56.94,1609790880,"2021-01-04"
1609833600,"Partly cloudy throughout the day.","partly-cloudy-day",1609860420,1609895160,0.74,0.0003,0.002,1609833600,0.16,"rain",54.09,1609891020,45.56,1609945080,53.59,1609891020,43.96,1609944900,44.06,0.82,1024.6,4.73,10.32,1609883940,0,0.39,2,1609878420,9.931,310.6,44.98,1609859520,54.09,1609891020,43,1609859220,53.59,1609891020,"2021-01-05"
1609920000,"Light rain in the afternoon.","rain",1609946820,1609981620,0.78,0.0014,0.0201,1609967100,0.94,"rain",54.67,1609977900,48.24,1610029140,54.17,1609977900,45.97,1610025060,45.28,0.85,1023.2,4.19,12.65,1609966980,38,0.59,2,1609963560,10,294.1,45.56,1609945080,54.67,1609977900,43.96,1609944900,54.17,1609977900,"2021-01-06"
1610006400,"Light rain overnight.","partly-cloudy-day",1610033220,1610068080,0.82,0,0.0002,1610042400,0.15,,55.49,1610063520,49.71,1610107800,54.99,1610063520,50.2,1610107800,45.79,0.82,1023.1,5.88,14.37,1610042280,50,0.64,2,1610050320,9.868,295.5,48.24,1610029140,55.49,1610063520,45.16,1610037780,54.99,1610063520,"2021-01-07"
1610092800,"Light rain in the morning.","rain",1610119560,1610154540,0.85,0.0017,0.0265,1610107200,0.91,"rain",55.76,1610150280,43.9,1610204400,55.26,1610150280,42.15,1610204400,47.61,0.85,1024.6,4.05,12.32,1610107200,346,0.56,2,1610137200,10,302.8,48.85,1610175600,55.76,1610150280,46.91,1610172900,55.26,1610150280,"2021-01-08"
1610179200,"Clear throughout the day.","clear-day",1610205960,1610241000,0.89,0,0.0001,1610200800,0.06,,56.83,1610229180,47.35,1610278980,56.33,1610229180,46.19,1610273280,42.94,0.78,1024.8,4.55,9.76,1610233620,337,0.31,2,1610223480,10,296.9,43.77,1610206920,56.83,1610229180,42.15,1610204400,56.33,1610229180,"2021-01-09"
1610265600,"Mostly cloudy throughout the day.","partly-cloudy-day",1610292360,1610327460,0.93,0,0.0001,1610312340,0.14,,54.47,1610318580,46.67,1610372880,53.97,1610318580,43.9,1610368680,43.25,0.76,1025,4.96,10.31,1610315580,28,0.73,2,1610309400,10,307.9,47.35,1610278980,54.47,1610318580,46.19,1610273280,53.97,1610318580,"2021-01-10"
1610352000,"Partly cloudy throughout the day.","partly-cloudy-day",1610378760,1610413920,0.96,0,0.0002,1610384400,0.09,,57.06,1610405640,49.1,1610459520,56.56,1610405640,48.98,1610463300,43.05,0.75,1024.3,5.21,11.57,1610384340,356,0.61,2,1610395980,10,306.2,46.39,1610381340,57.06,1610405640,43.03,1610383680,56.56,1610405640,"2021-01-11"
1610438400,"Mostly cloudy throughout the day.","partly-cloudy-day",1610465160,1610500380,0,0,0.0001,1610478360,0.24,,57.8,1610489220,51.21,1610542920,57.3,1610489220,51.7,1610542920,45.92,0.76,1025.7,2.71,8.05,1610467080,328,0.83,2,1610482260,10,294.6,49.1,1610459520,57.8,1610489220,48.98,1610463300,57.3,1610489220,"2021-01-12"
1610524800,"Mostly cloudy throughout the day.","partly-cloudy-day",1610551500,1610586840,0.04,0,0.0001,1610571600,0.24,,62.65,1610582220,50.51,1610636400,62.15,1610582220,51,1610636400,51.49,0.85,1027.3,3.89,7.81,1610603940,47,0.66,2,1610569800,10,289.1,51.21,1610542920,62.65,1610582220,51.7,1610542920,62.15,1610582220,"2021-01-13"
1610611200,"Clear throughout the day.","clear-day",1610637900,1610673300,0.07,0,0.0001,1610654340,0.18,,63.88,1610668140,50.22,1610719200,63.38,1610668140,50.71,1610719200,49.57,0.83,1026.3,5.26,12.02,1610654520,6,0.27,3,1610655720,10,281.5,50.12,1610639340,63.88,1610668140,50.61,1610639340,63.38,1610668140,"2021-01-14"
1610697600,"Partly cloudy throughout the day.","partly-cloudy-day",1610724300,1610759760,0.1,0,0.0001,1610743800,0.14,,65.1,1610754960,52.57,1610809200,64.6,1610754960,53.06,1610809200,47.67,0.73,1025.3,4.97,11.46,1610732580,2,0.54,3,1610741340,9.954,278.5,50.22,1610719200,65.1,1610754960,50.71,1610719200,64.6,1610754960,"2021-01-15"
1610784000,"Clear throughout the day.","clear-day",1610810640,1610846220,0.14,0,0.0001,1610830980,0.17,,64.48,1610827500,52.54,1610877780,63.98,1610827500,53.03,1610877780,48.39,0.74,1021.2,3.22,8.9,1610840100,320,0.3,3,1610828220,10,285.3,52.19,1610812020,64.48,1610827500,52.68,1610812020,63.98,1610827500,"2021-01-16"
1610870400,"Clear throughout the day.","clear-day",1610897040,1610932680,0.17,0,0.0001,1610902800,0.13,,68.94,1610922240,53.76,1610970300,68.44,1610922240,54.25,1610970300,44.6,0.6,1018.7,3.97,9.53,1610891220,7,0.23,3,1610914920,10,293.7,52.54,1610877780,68.94,1610922240,53.03,1610877780,68.44,1610922240,"2021-01-17"
1610956800,"Clear throughout the day.","clear-day",1610983440,1611019140,0.2,0,0.0001,1610956800,0.03,,73.85,1611013140,54.49,1611068400,73.35,1611013140,54.98,1611068400,28.65,0.34,1014.3,8.36,34.3,1611039600,1,0.25,2,1611001140,10,327.2,53.76,1610970300,73.85,1611013140,54.25,1610970300,73.35,1611013140,"2021-01-18"
1611043200,"Clear throughout the day.","clear-day",1611069780,1611105600,0.23,0,0.0001,1611097200,0.06,,64.29,1611100860,50.5,1611154800,63.79,1611100860,50.99,1611154800,18.96,0.21,1014.6,14.94,34.63,1611083040,14,0.07,2,1611087540,10,326.2,54.21,1611071580,64.29,1611100860,54.7,1611071580,63.79,1611100860,"2021-01-19"
1611129600,"Clear throughout the day.","clear-day",1611156180,1611192060,0.26,0,0.0001,1611197760,0.07,,64.17,1611185820,44.41,1611241200,63.67,1611185820,44.9,1611241200,27.54,0.34,1018.5,4.87,11.59,1611129660,26,0.02,3,1611173940,10,308.9,50.19,1611157320,64.17,1611185820,50.68,1611157320,63.67,1611185820,"2021-01-20"
1611216000,"Rain overnight.","partly-cloudy-day",1611242520,1611278520,0.29,0,0.0001,1611292140,0.1,,53.63,1611270300,48.16,1611327600,53.13,1611270300,45.41,1611327600,37.86,0.66,1017.3,4.69,12.65,1611274080,260,0.51,2,1611260340,10,317.5,43.82,1611244020,53.63,1611270300,43.04,1611244500,53.13,1611270300,"2021-01-21"
1611302400,"Rain in the morning and afternoon.","rain",1611328920,1611365040,0.32,0.0062,0.0467,1611317100,0.98,"rain",52.93,1611345900,45.87,1611414000,52.43,1611345900,42.5,1611414000,43.12,0.77,1011.7,6.58,15.22,1611316440,261,0.66,2,1611348120,9.942,351.2,48.15,1611327840,52.93,1611345900,45.19,1611329700,52.43,1611345900,"2021-01-22"
1611388800,"Clear throughout the day.","rain",1611415260,1611451500,0.35,0.0001,0.0003,1611388800,0.3,"rain",55.1,1611439200,46.37,1611489540,54.6,1611439200,43.46,1611500400,41.83,0.75,1014.1,6.16,12.77,1611406200,331,0.28,2,1611433380,10,360.6,45.77,1611416460,55.1,1611439200,42.5,1611414000,54.6,1611439200,"2021-01-23"
1611475200,"Rain starting in the afternoon.","rain",1611501600,1611537960,0.38,0.0048,0.0416,1611534360,0.98,"rain",50.65,1611518700,44.19,1611586800,50.15,1611518460,37.74,1611584040,41.46,0.78,1012.5,8.78,23.42,1611558000,276,0.74,2,1611519000,9.691,329.9,45.84,1611558000,50.65,1611518700,40.05,1611558000,50.15,1611518460,"2021-01-24"
1611561600,"Clear throughout the day.","rain",1611588000,1611624420,0.41,0.0004,0.0087,1611568800,0.88,"rain",51.46,1611611280,40.42,1611673200,51.35,1611610920,37.19,1611673200,33.22,0.58,1010.3,14.27,26.4,1611613740,301,0.1,2,1611606360,10,381.5,43.88,1611589740,51.46,1611611280,37.28,1611589800,51.35,1611610920,"2021-01-25"
1611648000,"Heavy rain starting in the afternoon.","rain",1611674340,1611710880,0.45,0.0084,0.0721,1611730800,0.99,"rain",49.81,1611697320,44.32,1611716700,44.44,1611695460,35.7,1611717000,35.36,0.69,1011.4,13.03,41.17,1611727020,145,0.61,2,1611692280,9.396,343.4,40.42,1611673200,49.81,1611697320,35.7,1611717000,44.44,1611695460,"2021-01-26"
1611734400,"Rain throughout the day.","rain",1611760680,1611797340,0.48,0.0277,0.2644,1611738300,1,"rain",53.27,1611780540,47.19,1611806280,52.85,1611783000,42.79,1611802800,44.73,0.82,1006.2,11.6,37.29,1611734400,154,0.85,2,1611778920,9.496,373.7,46.06,1611734400,53.27,1611780540,38.95,1611734400,52.85,1611783000,"2021-01-27"
1611820800,"Rain throughout the day.","rain",1611847080,1611883800,0.51,0.0273,0.2138,1611827160,1,"rain",52.85,1611881040,44.9,1611932400,52.35,1611881040,43.27,1611923220,47.28,0.89,1006.7,7.41,17.29,1611823620,157,0.87,2,1611865260,9.62,396.8,48.25,1611903600,52.85,1611881040,45.34,1611848040,52.35,1611881040,"2021-01-28"
1611907200,"Partly cloudy throughout the day.","rain",1611933420,1611970260,0.55,0.0189,0.2261,1611911100,0.96,"rain",52.96,1611964140,46.52,1611998460,52.46,1611964140,44.46,1612003620,42.53,0.79,1012.9,4.34,8.85,1611964740,200,0.49,2,1611951540,10,363.2,44.72,1611934860,52.96,1611964140,43.27,1611923220,52.46,1611964140,"2021-01-29"
1611993600,"Partly cloudy throughout the day.","partly-cloudy-day",1612019760,1612056780,0.58,0,0.0001,1612058460,0.18,,56.62,1612047420,50.69,1612104900,56.12,1612047420,51.18,1612104900,41.09,0.7,1020.8,4.53,9.23,1612044420,153,0.62,3,1612037760,10,310.6,46.52,1611998460,56.62,1612047420,44.46,1612003620,56.12,1612047420,"2021-01-30"
1612080000,"Mostly cloudy throughout the day.","partly-cloudy-day",1612106100,1612143240,0.62,0,0.0001,1612115640,0.21,,59.69,1612126920,48.56,1612191600,59.19,1612126920,46.68,1612191600,41.75,0.63,1020.3,4.29,10.2,1612117380,183,0.74,3,1612124100,10,300.7,50.66,1612107000,59.69,1612126920,51.15,1612107000,59.19,1612126920,"2021-01-31"
1612166400,"Rain in the evening and overnight.","rain",1612192440,1612229700,0.66,0.0073,0.0729,1612238520,0.97,"rain",60.93,1612216920,51.91,1612259520,60.43,1612216920,52.4,1612259520,44.55,0.71,1015.7,8.88,23.01,1612218660,166,0.51,3,1612210800,9.993,314.6,48.56,1612191600,60.93,1612216920,46.68,1612191600,60.43,1612216920,"2021-02-01"
1612252800,"Light rain in the morning.","rain",1612278840,1612316160,0.69,0.0121,0.1337,1612255680,0.99,"rain",57.38,1612300380,44.98,1612363620,56.88,1612300380,43.24,1612361700,49.05,0.86,1019.4,6.59,14.96,1612262220,235,0.59,3,1612299000,9.818,336.9,49.35,1612335600,57.38,1612300380,48.22,1612335600,56.88,1612300380,"2021-02-02"
1612339200,"Partly cloudy throughout the day.","partly-cloudy-day",1612365180,1612402620,0.73,0,0.0002,1612353180,0.16,,55.57,1612389060,46.62,1612450800,55.07,1612389060,44.59,1612432860,42.09,0.74,1023.1,6.17,15.18,1612387080,271,0.35,3,1612384740,10,346.3,44.98,1612363620,55.57,1612389060,43.24,1612361700,55.07,1612389060,"2021-02-03"
1612425600,"Clear throughout the day.","clear-day",1612451520,1612489080,0.77,0,0.0001,1612495740,0.05,,57.52,1612473960,45.57,1612537140,57.02,1612473960,44.7,1612537200,35.73,0.56,1023.9,4.77,11.91,1612436040,339,0.05,3,1612470180,10,328.6,46.24,1612453620,57.52,1612473960,44.59,1612432860,57.02,1612473960,"2021-02-04"
1612512000,"Clear throughout the day.","clear-day",1612537860,1612575540,0.8,0,0.0001,1612526400,0.06,,61.05,1612564680,46.85,1612621440,60.55,1612564680,47.38,1612620780,40.04,0.64,1022.3,3.73,10.46,1612567560,328,0.01,3,1612556700,10,318,45.57,1612537140,61.05,1612564680,44.35,1612539720,60.55,1612564680,"2021-02-05"
1612598400,"Clear throughout the day.","clear-day",1612624200,1612662000,0.84,0,0.0001,1612648800,0.06,,64.03,1612652700,46.76,1612710000,63.53,1612652700,45.16,1612710000,42.43,0.67,1019.1,3.6,8.48,1612657440,334,0.2,3,1612642980,10,326.9,46.85,1612621440,64.03,1612652700,46.43,1612626720,63.53,1612652700,"2021-02-06"
1612684800,"Partly cloudy throughout the day.","clear-day",1612710540,1612748520,0.88,0,0.0002,1612731600,0.09,,63.37,1612735200,46.55,1612796400,62.87,1612735200,45.67,1612792920,43.51,0.7,1015.4,4.46,9.92,1612745700,318,0.28,3,1612728660,10,325.6,46.72,1612711320,63.37,1612735200,44.97,1612711920,62.87,1612735200,"2021-02-07"
1612771200,"Overcast throughout the day.","partly-cloudy-day",1612796880,1612834980,0.91,0,0.0003,1612850340,0.11,,55.17,1612820580,49.97,1612864140,54.67,1612820580,50.46,1612864140,44.88,0.82,1014.6,4.11,10.81,1612852920,250,0.79,3,1612816080,10,297.2,46.37,1612799220,55.17,1612820580,45.67,1612792920,54.67,1612820580,"2021-02-08"
1612857600,"Overcast throughout the day.","partly-cloudy-day",1612883220,1612921440,0.95,0,0.0001,1612924320,0.15,,55.37,1612904580,48.78,1612969200,54.87,1612904580,48.38,1612963140,46.3,0.81,1016.6,4.59,11.37,1612908120,247,0.8,3,1612901460,10,293.8,49.97,1612864140,55.37,1612904580,50.46,1612864140,54.87,1612904580,"2021-02-09"
1612944000,"Clear throughout the day.","partly-cloudy-day",1612969560,1613007900,0.98,0,0.0002,1612980300,0.15,,57.15,1612997820,48.69,1613049300,56.65,1612997820,47.2,1613052000,45.65,0.79,1018.5,5.52,14.09,1613005560,259,0.36,4,1612988700,10,278.5,48.78,1612970280,57.15,1612997820,47.98,1613024580,56.65,1612997820,"2021-02-10"
1613030400,"Rain starting in the afternoon.","rain",1613055900,1613094360,0.01,0.0217,0.14,1613091720,1,"rain",55.4,1613082000,49.84,1613142000,54.9,1613082000,50.33,1613142000,45.8,0.81,1017.5,6.89,21.43,1613107500,209,0.91,3,1613074320,9.685,276,48.69,1613049300,55.4,1613082000,47.2,1613052000,54.9,1613082000,"2021-02-11"
1613116800,"Partly cloudy throughout the day.","partly-cloudy-day",1613142180,1613180820,0.05,0.0001,0.0003,1613138640,0.21,"rain",56.5,1613167200,51.1,1613187480,56,1613167200,51.59,1613187480,46.3,0.79,1017.1,8.92,16.8,1613197980,280,0.52,4,1613161500,10,294.9,49.78,1613143500,56.5,1613167200,50.27,1613143500,56,1613167200,"2021-02-12"
1613203200,"Rain in the morning.","rain",1613228520,1613267280,0.08,0.0035,0.0455,1613231700,0.94,"rain",56.83,1613244840,47.81,1613310900,56.33,1613244840,44.59,1613303580,45.94,0.77,1017,10.23,22.26,1613232060,278,0.64,3,1613247060,10,315.2,49.77,1613286000,56.83,1613244840,50.26,1613286000,56.33,1613244840,"2021-02-13"
1613289600,"Rain overnight.","rain",1613314860,1613353740,0.11,0.0005,0.01,1613372400,0.91,"rain",54.64,1613340420,51.49,1613358000,54.14,1613340420,51.98,1613358000,42.85,0.74,1018.7,7,17.75,1613296920,268,0.77,3,1613335080,10,288.4,47.81,1613310900,54.64,1613340420,44.59,1613303580,54.14,1613340420,"2021-02-14"
1613376000,"Rain in the morning and afternoon.","rain",1613401200,1613440200,0.14,0.0111,0.0398,1613407860,0.98,"rain",55.47,1613416200,47.5,1613484060,54.97,1613416200,44.69,1613481540,51.05,0.93,1018.5,8.94,19.35,1613429400,250,0.93,3,1613420760,9.904,265.3,49.88,1613458800,55.47,1613416200,50.37,1613458800,54.97,1613416200,"2021-02-15"
1613462400,"Partly cloudy throughout the day.","clear-day",1613487540,1613526660,0.17,0,0.0001,1613462400,0.08,,54.42,1613519760,45.74,1613574000,53.92,1613519760,43.31,1613574000,42.46,0.73,1021.1,7.47,16.04,1613462940,303,0.27,4,1613505840,10,262.1,47.5,1613484060,54.42,1613519760,44.69,1613481540,53.92,1613519760,"2021-02-16"
1613548800,"Clear throughout the day.","clear-day",1613573880,1613613180,0.2,0,0.0001,1613584800,0.08,,60.86,1613602800,46.53,1613659800,60.36,1613602800,44.8,1613660400,37.91,0.6,1023,5.26,14.53,1613599020,340,0.17,5,1613593440,10,255.2,45.73,1613574480,60.86,1613602800,42.93,1613576340,60.36,1613602800,"2021-02-17"
1613635200,"Light rain overnight.","partly-cloudy-day",1613660160,1613699640,0.23,0,0.0001,1613646000,0.1,,59.46,1613688540,49.16,1613746800,58.96,1613688540,46.2,1613744280,37.87,0.58,1026.8,4.84,10.96,1613693100,228,0.39,5,1613680080,10,252.2,46.53,1613659800,59.46,1613688540,44.79,1613660520,58.96,1613688540,"2021-02-18"
1613721600,"Rain in the morning and overnight.","rain",1613746500,1613786100,0.26,0.0109,0.0632,1613740320,0.95,"rain",54.26,1613778060,48.38,1613825760,53.76,1613778060,43.89,1613825400,48.31,0.88,1025.8,7.41,14.85,1613796840,222,0.83,4,1613766780,10,268.9,49.16,1613746800,54.26,1613778060,46.2,1613744280,53.76,1613778060,"2021-02-19"
1613808000,"Clear throughout the day.","rain",1613832840,1613872560,0.29,0.0011,0.0214,1613815200,0.96,"rain",57.52,1613863860,47.14,1613919600,57.02,1613863860,45.25,1613919600,42.15,0.68,1027.2,9.97,22.49,1613815500,294,0.28,3,1613853300,10,356.7,48.38,1613825760,57.52,1613863860,43.89,1613825400,57.02,1613863860,"2021-02-20"
1613894400,"Clear throughout the day.","clear-day",1613919180,1613959020,0.32,0,0.0001,1613926020,0.06,,59.77,1613946420,49.56,1614005220,59.27,1613946420,50.05,1614005220,39.52,0.61,1030.2,4.89,11.17,1613951580,322,0.04,4,1613939100,10,323.1,47.09,1613920980,59.77,1613946420,44.99,1613921700,59.27,1613946420,"2021-02-21"
1613980800,"Clear throughout the day.","clear-day",1614005460,1614045480,0.36,0,0.0001,1614002880,0.09,,67.03,1614036900,52.48,1614091800,66.53,1614036900,52.97,1614091800,40.83,0.56,1025,5.11,13.18,1614027660,349,0.05,5,1614025380,10,305.9,49.56,1614005220,67.03,1614036900,50.05,1614005220,66.53,1614036900,"2021-02-22"
1614067200,"Clear throughout the day.","partly-cloudy-day",1614091800,1614131940,0.39,0,0.0001,1614104220,0.05,,75.43,1614121020,49.26,1614178740,74.93,1614121020,48.81,1614178800,39,0.48,1020.1,6.1,17.54,1614113580,335,0.35,4,1614112080,10,310.7,52.48,1614091800,75.43,1614121020,52.97,1614091800,74.93,1614121020,"2021-02-23"
1614153600,"Clear throughout the day.","clear-day",1614178140,1614218400,0.42,0,0,,0,,67.19,1614207120,51.79,1614265200,66.69,1614207120,52.28,1614265200,32.82,0.42,1022.4,7.06,25.42,1614233100,345,0.04,5,1614197460,10,303.9,49.26,1614178740,67.19,1614207120,48.81,1614178800,66.69,1614207120,"2021-02-24"
1614240000,"Clear throughout the day.","clear-day",1614264420,1614304860,0.46,0,0.0001,1614278760,0.05,,61.73,1614286800,46.97,1614350640,61.23,1614286800,45.55,1614350940,27.91,0.37,1024.2,6.76,25.82,1614240000,339,0.2,4,1614284400,10,305,50.52,1614322800,61.73,1614286800,51.01,1614322800,61.23,1614286800,"2021-02-25"
1614326400,"Clear throughout the day.","clear-day",1614350760,1614391320,0.5,0,0.0001,1614355200,0.06,,57,1614379920,44.61,1614437460,56.5,1614379920,39.95,1614437160,40.83,0.67,1021.4,7.18,20.75,1614391140,301,0.03,4,1614370680,10,343.2,46.97,1614350640,57,1614379920,45.15,1614409200,56.5,1614379920,"2021-02-26"
1614412800,"Clear throughout the day.","clear-day",1614437100,1614477780,0.53,0,0.0001,1614450960,0.06,,57.54,1614466800,49.94,1614524400,57.04,1614466800,50.43,1614524400,36.04,0.56,1021.2,8.82,17.67,1614470280,317,0.03,4,1614456600,10,375.2,44.61,1614437460,57.54,1614466800,39.95,1614437160,57.04,1614466800,"2021-02-27"
1614499200,"Clear throughout the day.","clear-day",1614523380,1614564240,0.57,0,0.0001,1614513600,0.04,,64.46,1614554580,48.14,1614610380,63.96,1614554580,48.63,1614610380,31.49,0.4,1021.8,5.94,14.67,1614548220,350,0.11,4,1614543720,10,336.3,49.93,1614524580,64.46,1614554580,50.42,1614524580,63.96,1614554580,"2021-02-28"
1614585600,"Clear throughout the day.","clear-day",1614609720,1614650700,0.61,0,0.0001,1614668400,0.07,,64.88,1614642660,47.41,1614696960,64.38,1614642660,46.18,1614695640,34.61,0.47,1019.3,5.03,12.45,1614636180,236,0.04,5,1614630180,10,324.9,48.14,1614610380,64.88,1614642660,48.63,1614610380,64.38,1614642660,"2021-03-01"
1614672000,"Mostly cloudy throughout the day.","partly-cloudy-day",1614696000,1614737160,0.64,0.0001,0.0017,1614718500,0.08,"rain",58.98,1614721980,48.65,1614782940,58.48,1614721980,49.14,1614782940,37.42,0.55,1013.2,5.15,11.61,1614718860,288,0.66,3,1614715560,10,365.7,47.41,1614696960,58.98,1614721980,46.18,1614695640,58.48,1614721980,"2021-03-02"
1614758400,"Mostly cloudy throughout the day.","partly-cloudy-day",1614782340,1614823620,0.68,0,0.0006,1614816000,0.11,,57.79,1614805020,46.41,1614869640,57.29,1614805020,44.17,1614869640,41.5,0.69,1010.5,5.96,19.18,1614812460,244,0.65,3,1614802620,10,379.4,48.65,1614782940,57.79,1614805020,45.22,1614824820,57.29,1614805020,"2021-03-03"
1614844800,"Clear throughout the day.","clear-day",1614868620,1614910080,0.72,0,0.0001,1614899040,0.09,,56.38,1614898620,46.98,1614955860,55.88,1614898620,45.92,1614955200,41.7,0.69,1023.1,6.09,13.81,1614895740,230,0.28,4,1614889860,10,329.6,46.41,1614869640,56.38,1614898620,44.17,1614869640,55.88,1614898620,"2021-03-04"
1614931200,"Rain overnight.","rain",1614954960,1614996540,0.75,0.002,0.0928,1615014000,0.94,"rain",61.28,1614981840,45.08,1615040940,60.78,1614981840,41.66,1615018320,44.21,0.7,1020.6,6.76,27.51,1615013760,191,0.48,4,1614974580,9.952,322.3,46.98,1614955860,61.28,1614981840,45.92,1614955200,60.78,1614981840,"2021-03-05"
1615017600,"Partly cloudy throughout the day.","rain",1615041300,1615083000,0.79,0.0045,0.1155,1615017600,0.97,"rain",54.67,1615071060,44.69,1615122060,54.17,1615071060,43.32,1615128180,41.27,0.74,1020.3,7.61,17.29,1615017600,279,0.42,4,1615063080,10,356.1,45.08,1615040940,54.67,1615071060,41.66,1615018320,54.17,1615071060,"2021-03-06"
1615104000,"Clear throughout the day.","clear-day",1615127580,1615169460,0.83,0,0.0001,1615167060,0.06,,56.14,1615154220,47.89,1615201080,55.64,1615154220,43.51,1615200960,39.53,0.67,1019.7,6.54,16.49,1615164540,278,0.11,5,1615148640,10,328.8,44.69,1615122060,56.14,1615154220,43.32,1615128180,55.64,1615154220,"2021-03-07"
1615190400,"Partly cloudy throughout the day.","rain",1615213920,1615255920,0.86,0.0003,0.0034,1615230000,0.29,"rain",55.51,1615238700,47.64,1615298100,55.01,1615238700,44.86,1615299360,36.72,0.59,1021.2,9.28,17.97,1615193220,228,0.5,4,1615235220,9.919,367.9,47.89,1615201080,55.51,1615238700,43.51,1615200960,55.01,1615238700,"2021-03-08"
1615276800,"Rain until morning, starting again in the evening.","rain",1615300200,1615342380,0.89,0.0134,0.1041,1615345680,0.98,"rain",56.18,1615323840,44.97,1615388400,55.68,1615323840,40.94,1615388400,40.72,0.7,1018.6,8.69,18.31,1615338120,183,0.86,3,1615320780,9.917,401.9,45.67,1615349040,56.18,1615323840,41.53,1615349940,55.68,1615323840,"2021-03-09"`;

export async function getServerSideProps(context: GetServerSidePropsContext) {
  const devServer = context.query.devServer as string;

  const isDev = process.env.NODE_ENV !== "production";

  const frameSrc = ["frame-src", publicRuntimeConfig.sandboxDomain, devServer]
    .filter(Boolean)
    .join(" ");

  const connectSrc = [
    "connect-src",
    "'self'",
    // for local dev
    isDev && "webpack://*",
    isDev && "ws://*",
    // for hitting the GitHub API
    "https://api.github.com/",
    // for Analytics
    "https://octo-metrics.azurewebsites.net/api/CaptureEvent",
    "https://eastus-8.in.applicationinsights.azure.com/",
    devServer,
  ]
    .filter(Boolean)
    .join(" ");

  context.res.setHeader(
    "Content-Security-Policy",
    [context.res.getHeader("Content-Security-Policy"), frameSrc, connectSrc]
      .filter(Boolean)
      .join(";")
  );

  return { props: {} };
}
